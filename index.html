<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Football Picks - Live Standings</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .drop-zone {
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .drop-zone:hover, .drop-zone.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .trophy { color: #eab308; }
        .silver { color: #9ca3af; }
        .bronze { color: #ea580c; }
    </style>
</head>
<body>
    <div id="root">
        <!-- Initial Upload State -->
        <div id="upload-screen" class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-xl shadow-lg p-8 text-center">
                    <div class="mb-6">
                        <div class="w-16 h-16 mx-auto mb-4 bg-yellow-500 rounded-full flex items-center justify-center">
                            <span class="text-white text-2xl font-bold">üèÜ</span>
                        </div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">
                            College Football Picks Dashboard
                        </h1>
                        <p class="text-gray-600">Upload your weekly picks CSV to generate live standings</p>
                    </div>

                    <div 
                        id="drop-zone" 
                        class="drop-zone"
                        onclick="document.getElementById('file-input').click()"
                    >
                        <div id="upload-content">
                            <div class="w-12 h-12 mx-auto mb-4 bg-gray-400 rounded-full flex items-center justify-center">
                                <span class="text-white text-xl">üìÅ</span>
                            </div>
                            <p class="text-lg font-semibold text-gray-700 mb-2">
                                Drop your CSV file here
                            </p>
                            <p class="text-gray-500 mb-4">or click to browse</p>
                            <p class="text-sm text-gray-400">
                                Export your Google Sheet as CSV and drop it here
                            </p>
                        </div>
                        <div id="loading-content" style="display: none;">
                            <div class="w-12 h-12 mx-auto mb-4">
                                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                            </div>
                            <p>Processing your picks...</p>
                        </div>
                    </div>

                    <input 
                        type="file" 
                        id="file-input" 
                        accept=".csv" 
                        style="display: none;"
                    />

                    <div id="error-message" style="display: none;" class="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg">
                        <p class="text-red-700" id="error-text"></p>
                    </div>

                    <div class="mt-8 text-left">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">How to use:</h3>
                        <ol class="list-decimal list-inside space-y-2 text-gray-600">
                            <li>Go to your Google Sheet with picks data</li>
                            <li>File ‚Üí Download ‚Üí Comma-separated values (.csv)</li>
                            <li>Drag and drop the CSV file above</li>
                            <li>Share this page URL with your league!</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard State -->
        <div id="dashboard-screen" style="display: none;" class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
            <div class="max-w-6xl mx-auto">
                <!-- Header -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                                <span class="text-yellow-500 text-4xl">üèÜ</span>
                                College Football Picks - Live Standings
                            </h1>
                            <p class="text-gray-600 mt-2">Current week standings</p>
                        </div>
                        <div class="text-right">
                            <button 
                                onclick="resetDashboard()"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                            >
                                Upload New Week
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-lg shadow-md p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Current Leader</p>
                                <p class="text-lg font-bold text-gray-800" id="leader-name">-</p>
                                <p class="text-sm text-green-600" id="leader-points">- points</p>
                            </div>
                            <span class="text-yellow-500 text-3xl">üèÜ</span>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-md p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Total Players</p>
                                <p class="text-2xl font-bold text-gray-800" id="total-players">-</p>
                            </div>
                            <span class="text-blue-500 text-3xl">üë•</span>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Average Score</p>
                                <p class="text-2xl font-bold text-gray-800" id="avg-score">-</p>
                            </div>
                            <span class="text-purple-500 text-3xl">üéØ</span>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Games Picked</p>
                                <p class="text-2xl font-bold text-gray-800" id="games-count">-</p>
                                <p class="text-sm text-gray-500">per player</p>
                            </div>
                            <div class="w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center text-white font-bold" id="games-badge">
                                -
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Standings Table -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-2xl font-bold text-gray-800">Live Standings</h2>
                        <p class="text-gray-600">Current rankings based on total points earned</p>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-4 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                                    <th class="px-6 py-4 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">Player</th>
                                    <th class="px-6 py-4 text-center text-sm font-medium text-gray-500 uppercase tracking-wider">Total Points</th>
                                    <th class="px-6 py-4 text-center text-sm font-medium text-gray-500 uppercase tracking-wider">Games</th>
                                    <th class="px-6 py-4 text-center text-sm font-medium text-gray-500 uppercase tracking-wider">Avg Points</th>
                                    <th class="px-6 py-4 text-center text-sm font-medium text-gray-500 uppercase tracking-wider">Performance</th>
                                </tr>
                            </thead>
                            <tbody id="standings-table" class="bg-white divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Top 3 Highlight -->
                <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4" id="podium">
                </div>

                <!-- Footer -->
                <div class="mt-6 text-center text-gray-500 text-sm">
                    <p>Upload a new CSV file each week to update standings ‚Ä¢ Powered by GitHub Pages</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentData = null;

        // Setup drag and drop
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        function showError(message) {
            document.getElementById('error-message').style.display = 'block';
            document.getElementById('error-text').textContent = message;
        }

        function hideError() {
            document.getElementById('error-message').style.display = 'none';
        }

        function showLoading() {
            document.getElementById('upload-content').style.display = 'none';
            document.getElementById('loading-content').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('upload-content').style.display = 'block';
            document.getElementById('loading-content').style.display = 'none';
        }

        function handleFileUpload(file) {
            if (!file.name.toLowerCase().endsWith('.csv')) {
                showError('Please upload a CSV file');
                return;
            }

            showLoading();
            hideError();

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csvText = e.target.result;
                    const processedData = processCSVData(csvText);
                    currentData = processedData;
                    showDashboard();
                    hideLoading();
                } catch (err) {
                    showError('Failed to process CSV: ' + err.message);
                    hideLoading();
                }
            };
            reader.readAsText(file);
        }

        function processCSVData(csvText) {
            const parsed = Papa.parse(csvText, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true
            });

            const participants = parsed.data.filter(row => row['Email Address']);
            
            const standings = participants.map(participant => {
                const email = participant['Email Address'];
                const name = email.split('@')[0];
                
                let totalPoints = 0;
                let gamesPlayed = 0;
                
                // Count Column entries
                Object.keys(participant).forEach(key => {
                    if (key.startsWith('Column') && typeof participant[key] === 'number') {
                        gamesPlayed++;
                    }
                });
                
                // Try to find total points - use last column if it's a reasonable number
                const lastCol = Object.keys(participant).pop();
                if (typeof participant[lastCol] === 'number' && participant[lastCol] > 0) {
                    totalPoints = participant[lastCol];
                } else {
                    // Sum all Column entries
                    Object.keys(participant).forEach(key => {
                        if (key.startsWith('Column') && typeof participant[key] === 'number') {
                            totalPoints += participant[key];
                        }
                    });
                }
                
                return {
                    name: name,
                    email: email,
                    totalPoints: totalPoints,
                    gamesPlayed: gamesPlayed,
                    avgPoints: gamesPlayed > 0 ? (totalPoints / gamesPlayed) : 0
                };
            });

            // Sort by total points
            standings.sort((a, b) => b.totalPoints - a.totalPoints);
            
            // Add ranks
            standings.forEach((player, index) => {
                player.rank = index + 1;
            });

            return {
                standings: standings,
                stats: {
                    totalParticipants: standings.length,
                    averageScore: standings.length > 0 ? 
                        (standings.reduce((sum, p) => sum + p.totalPoints, 0) / standings.length).toFixed(1) : 0,
                    leader: standings[0] || null,
                    gamesPerPlayer: standings[0]?.gamesPlayed || 0
                }
            };
        }

        function showDashboard() {
            document.getElementById('upload-screen').style.display = 'none';
            document.getElementById('dashboard-screen').style.display = 'block';
            renderDashboard();
        }

        function resetDashboard() {
            document.getElementById('upload-screen').style.display = 'block';
            document.getElementById('dashboard-screen').style.display = 'none';
            currentData = null;
            fileInput.value = '';
            hideError();
            hideLoading();
        }

        function renderDashboard() {
            const { standings, stats } = currentData;

            // Update stats
            document.getElementById('leader-name').textContent = stats.leader?.name || 'N/A';
            document.getElementById('leader-points').textContent = `${stats.leader?.totalPoints || 0} points`;
            document.getElementById('total-players').textContent = stats.totalParticipants;
            document.getElementById('avg-score').textContent = stats.averageScore;
            document.getElementById('games-count').textContent = stats.gamesPerPlayer;
            document.getElementById('games-badge').textContent = stats.gamesPerPlayer;

            // Render standings table
            const tableBody = document.getElementById('standings-table');
            tableBody.innerHTML = '';

            standings.forEach((player, index) => {
                const row = document.createElement('tr');
                row.className = `hover:bg-gray-50 transition-colors ${index < 3 ? 'bg-gradient-to-r from-yellow-50 to-transparent' : ''}`;
                
                const getRankDisplay = (rank) => {
                    if (rank === 1) return '<span class="text-yellow-500 text-2xl">üèÜ</span>';
                    if (rank === 2) return '<span class="text-gray-400 text-2xl">ü•à</span>';
                    if (rank === 3) return '<span class="text-orange-600 text-2xl">ü•â</span>';
                    return `<span class="w-6 h-6 flex items-center justify-center text-gray-600 font-bold">${rank}</span>`;
                };

                const getProgressColor = (avgPoints) => {
                    if (avgPoints >= 1.2) return 'bg-green-500';
                    if (avgPoints >= 1.1) return 'bg-blue-500';
                    if (avgPoints >= 1.0) return 'bg-yellow-500';
                    return 'bg-red-500';
                };

                const getPerformanceLabel = (avgPoints) => {
                    if (avgPoints >= 1.2) return 'Excellent';
                    if (avgPoints >= 1.1) return 'Good';
                    if (avgPoints >= 1.0) return 'Average';
                    return 'Below Avg';
                };

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center gap-2">
                            ${getRankDisplay(player.rank)}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-sm">
                                ${player.name.charAt(0).toUpperCase()}
                            </div>
                            <div class="ml-3">
                                <div class="text-sm font-medium text-gray-900">${player.name}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <div class="text-lg font-bold text-gray-900">${player.totalPoints}</div>
                        ${index === 0 ? '<div class="text-xs text-yellow-600">LEADER</div>' : ''}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-600">
                        ${player.gamesPlayed}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <div class="text-sm font-medium text-gray-900">${player.avgPoints.toFixed(2)}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div 
                                class="h-2 rounded-full ${getProgressColor(player.avgPoints)}"
                                style="width: ${Math.min((player.avgPoints / 1.3) * 100, 100)}%"
                            ></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">
                            ${getPerformanceLabel(player.avgPoints)}
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Render top 3 podium
            const podium = document.getElementById('podium');
            podium.innerHTML = '';

            standings.slice(0, 3).forEach((player, index) => {
                const podiumCard = document.createElement('div');
                const gradients = [
                    'bg-gradient-to-br from-yellow-400 to-yellow-600',
                    'bg-gradient-to-br from-gray-300 to-gray-500', 
                    'bg-gradient-to-br from-orange-400 to-orange-600'
                ];
                const places = ['ü•á 1st Place', 'ü•à 2nd Place', 'ü•â 3rd Place'];
                
                podiumCard.className = `rounded-xl shadow-lg p-6 text-white ${gradients[index]}`;
                podiumCard.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold">${places[index]}</h3>
                        <div class="text-2xl font-bold">${player.totalPoints}</div>
                    </div>
                    <div class="text-lg font-semibold">${player.name}</div>
                    <div class="text-sm opacity-90">Avg: ${player.avgPoints.toFixed(2)} pts/game</div>
                `;
                podium.appendChild(podiumCard);
            });
        }
    </script>
</body>
</html>
